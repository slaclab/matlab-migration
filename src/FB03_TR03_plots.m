% Setup
devnames = {'1';'2';'3';'4';'5';'6';'7';'8';'9';'10';'1';'1 SP';'2';'2 SP';'3';'3 SP';'4';'4 SP';'5';'5 SP';'6';'6 SP';'7';'7 SP';'8';'8 SP';'9';'9 SP';'10';'10 SP';'1';'2';'3';'4';'5';'6';'7';'8';'9';'10';'11';'12';'13';'14';'15';'16';'17';'18';'19';'20';'21';'22';'23';'24';'25';'26';'27';'28';'29';'30';'31';'32';'33';'34';'35';'36';'37';'38';'39';'40'};
pvs = {'FBCK:FB03:TR03:A1HST';'FBCK:FB03:TR03:A2HST';'FBCK:FB03:TR03:A3HST';'FBCK:FB03:TR03:A4HST';'FBCK:FB03:TR03:A5HST';'FBCK:FB03:TR03:A6HST';'FBCK:FB03:TR03:A7HST';'FBCK:FB03:TR03:A8HST';'FBCK:FB03:TR03:A9HST';'FBCK:FB03:TR03:A10HST';'FBCK:FB03:TR03:S1HST';'FBCK:FB03:TR03:S1DESHST';'FBCK:FB03:TR03:S2HST';'FBCK:FB03:TR03:S2DESHST';'FBCK:FB03:TR03:S3HST';'FBCK:FB03:TR03:S3DESHST';'FBCK:FB03:TR03:S4HST';'FBCK:FB03:TR03:S4DESHST';'FBCK:FB03:TR03:S5HST';'FBCK:FB03:TR03:S5DESHST';'FBCK:FB03:TR03:S6HST';'FBCK:FB03:TR03:S6DESHST';'FBCK:FB03:TR03:S7HST';'FBCK:FB03:TR03:S7DESHST';'FBCK:FB03:TR03:S8HST';'FBCK:FB03:TR03:S8DESHST';'FBCK:FB03:TR03:S9HST';'FBCK:FB03:TR03:S9DESHST';'FBCK:FB03:TR03:S10HST';'FBCK:FB03:TR03:S10DESHST';'FBCK:FB03:TR03:M1HST';'FBCK:FB03:TR03:M2HST';'FBCK:FB03:TR03:M3HST';'FBCK:FB03:TR03:M4HST';'FBCK:FB03:TR03:M5HST';'FBCK:FB03:TR03:M6HST';'FBCK:FB03:TR03:M7HST';'FBCK:FB03:TR03:M8HST';'FBCK:FB03:TR03:M9HST';'FBCK:FB03:TR03:M10HST';'FBCK:FB03:TR03:M11HST';'FBCK:FB03:TR03:M12HST';'FBCK:FB03:TR03:M13HST';'FBCK:FB03:TR03:M14HST';'FBCK:FB03:TR03:M15HST';'FBCK:FB03:TR03:M16HST';'FBCK:FB03:TR03:M17HST';'FBCK:FB03:TR03:M18HST';'FBCK:FB03:TR03:M19HST';'FBCK:FB03:TR03:M20HST';'FBCK:FB03:TR03:M21HST';'FBCK:FB03:TR03:M22HST';'FBCK:FB03:TR03:M23HST';'FBCK:FB03:TR03:M24HST';'FBCK:FB03:TR03:M25HST';'FBCK:FB03:TR03:M26HST';'FBCK:FB03:TR03:M27HST';'FBCK:FB03:TR03:M28HST';'FBCK:FB03:TR03:M29HST';'FBCK:FB03:TR03:M30HST';'FBCK:FB03:TR03:M31HST';'FBCK:FB03:TR03:M32HST';'FBCK:FB03:TR03:M33HST';'FBCK:FB03:TR03:M34HST';'FBCK:FB03:TR03:M35HST';'FBCK:FB03:TR03:M36HST';'FBCK:FB03:TR03:M37HST';'FBCK:FB03:TR03:M38HST';'FBCK:FB03:TR03:M39HST';'FBCK:FB03:TR03:M40HST'};

% Get FBCK data
fbckdata = cell(size(pvs));
for i=1:size(pvs)
    fbckdata{i}.pvname = pvs{i};
    fbckdata{i}.devname = devnames{i};
    [val, ts] = lcaGet(pvs{i});
    fbckdata{i}.waveform = val;
    if exist('epics2matlabTime')
        ts = epics2matlabTime(ts);
    end
    fbckdata{i}.timestamp = ts;
end

varname = 'fbckdata';

% Print FBCK data
celldisp(fbckdata);
whos(varname);

% Print help
path = sprintf('/u1/lcls/matlab/Feedback/fbckdata_%f', now());
path = regexprep(path, '\.', '_');
help = sprintf('Type e.g. ''save %s %s'' to save %s to %s.mat.', path, varname, varname, path);
disp('--------------------------------------------------------------------------------------');
disp(help);