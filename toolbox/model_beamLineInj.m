function [beamLine, beamLineDL, beamLineSP, beamLineBC1, beamLineBC2] = model_beamLineInj(region, varargin)
%MODEL_BEAMLINEINJ
% [BEAMLINE, BEAMLINEDL, BEAMLINESP, BEAMLINEBC1, BEAMLINEBC2] = MODEL_BEAMLINEINJ(REGION) Returns beam line
% description list for injector.

% Features:

% Input arguments:
%    REGION: List of regions to return, IN, GS, DL, SP, BC1, BC2, ALL
%    OPTS:   Options
%            DESIGN: Default 0, if 0 and model simulation, Laser Heater
%                    optional

% Output arguments:
%    BEAMLINE:   Cell array of beam line information for INJ
%    BEAMLINEDL: Cell array of beam line information for DL1
%    BEAMLINESP: Cell array of beam line information for SAB
%    BEAMLINEBC1: Cell array of beam line information for BC1
%    BEAMLINEBC2: Cell array of beam line information for BC2

% Compatibility: Version 7 and higher
% Called functions: none

% Author: Henrik Loos, SLAC

% --------------------------------------------------------------------
% Set default options.
if nargin < 1, region=[];end
if isempty(region), region={'IN' 'DL'};end

[d,d,modelSimul]=model_init;

optsdef=struct( ...
    'design',0 ...
    );

% Use default options if OPTS undefined.
opts=util_parseOptions(varargin{:},optsdef);


% ----------------- Laser Heater -----------------------------
if modelSimul && ~opts.design
    LSRHTR_ON = lcaGet('SIOC:SYS0:ML00:AO876');          %set to 1E-12 for OFF and 1.0 for ON (nominal)
else
    LSRHTR_ON = 1;
end

%  KQA01 = -12.317411498864;            % new design with laser-heater ON (chicane and und, w/Betx=Bety=12 m), based on measured (back-tracked) TWSS0
%  KQA02 =  13.706906173749;
%  KQE01 =  -6.538179321052;
%  KQE02 =   5.354060093454;
%  KQE03 =   6.054674881291;
%  KQE04 =  -5.235476556481;

Ei=0.135;    %initial beam energy (GeV) (150->135 MeV on July 9, 2003)
CLIGHT  =2.99792458e8;  %speed of light [m/s]
Cb      =1.0E10/CLIGHT; %energy to magnetic rigidity
GeV2MeV =1000.0;        %GeV to MeV
mc2     =510.99906E-6;  % e- rest mass [GeV]
TWOPI   =2*pi;
RADDEG  =pi/180;

dLBh= 0.0144;     %increase to lengthen BXH1-4 eff. length (m)
LBh = 0.110+dLBh; %5D3.9 "Z" length (m)   laser-heater chicane bends approx. effective length (R. Carr, 01-AUG-05 -PE)
GBh = 30E-3;      %5D3.9 gap height (m)
LQx = 0.1080;         %Everson-Tesla (ET) quads "1.259Q3.5" effective length (m)

Brhoh = Cb*Ei;              %beam rigidity at heater (kG-m)
BBh1  = -4.751481741801*LSRHTR_ON;    %heater-chicane bend field for 35-mm etaX_pk (kG)
RBh1  = Brhoh/BBh1;         %heater-chicane bend radius (m)
ABh1  = asin(LBh/RBh1);     %heater-chicane bend angle (rad)
ABh1S = asin((LBh/2)/RBh1); %"short" half heater-chicane bend angle (rad)
LBh1S = RBh1*ABh1S;         %"short" half heater-chicane bend path length (m)
ABh1L = ABh1-ABh1S;         %"long" half heater-chicane bend angle (rad)
LBh1L = RBh1*ABh1L;         %"long" half heater-chicane bend path length (m)

BXh1A={'be' 'BXH1'  LBh1S [+ABh1S GBh/2     0     0 0.4 0.0 0]}';
BXh1B={'be' 'BXH1'  LBh1L [+ABh1L GBh/2     0 +ABh1 0.0 0.4 0]}';
BXh2A={'be' 'BXH2'  LBh1L [-ABh1L GBh/2 -ABh1     0 0.4 0.0 0]}';
BXh2B={'be' 'BXH2'  LBh1S [-ABh1S GBh/2     0     0 0.0 0.4 0]}';
BXh3A={'be' 'BXH3'  LBh1S [-ABh1S GBh/2     0     0 0.4 0.0 0]}';
BXh3B={'be' 'BXH3'  LBh1L [-ABh1L GBh/2     0 -ABh1 0.0 0.4 0]}';
BXh4A={'be' 'BXH4'  LBh1L [+ABh1L GBh/2 +ABh1     0 0.4 0.0 0]}';
BXh4B={'be' 'BXH4'  LBh1S [+ABh1S GBh/2     0     0 0.0 0.4 0]}';

Dh00={'dr' ''        0.13453045-dLBh/2            []}';
Dh01={'dr' ''        (0.155-dLBh)/cos(ABh1)            []}';
Dh02a={'dr' ''       0.06717020-dLBh/2            []}';
Dh03a={'dr' ''       0.09290825             []}';
Dh03b={'dr' ''       0.08401830             []}';
Dh02b={'dr' ''       0.09503020-dLBh/2             []}';
Dh06={'dr' ''        0.13010070-dLBh/2            []}';
HTRUND={'mo' 'HTRUND'        0          []}';

lam   = 0.054;                            % laser-heater undulator period [m]
lamr  = 758E-9;                           % heater laser wavelength [m]
gami  = Ei/mc2;                           % Lorentz energy factor in laser-heater undulator [ ]
K_und = LSRHTR_ON*sqrt(2*(lamr*2*gami^2/lam - 1));  % undulator K for laser heater und.
Lhun  = 0.506263;                         % length of laser-heater undulator
kqlh  = (K_und*2*pi/lam/sqrt(2)/gami)^2;  % natural undulator focusing "k" in y-plane [m^-2]

LHBEG={'mo' 'LHBEG'        0          []}';
LHEND={'mo' 'LHEND'        0          []}';
%YAG04={'mo' 'YAG04'        0          []}'; %temporarily (Dec. '06 - July '07) placed in laser-heater region (135 MeV) - center of device in MAD is defined as center of YAG crystal, not mirror
OTRH1={'mo' 'OTRH1'        0          []}'; %Laser-heater OTR screen PLACE-HOLDER just upbeam of heater-undulator (not installed until summer 2008)
OTRH2={'mo' 'OTRH2'        0          []}'; %Laser-heater OTR screen PLACE-HOLDER just dnbeam of heater-undulator (not installed until summer 2008)

% laser-heater undulator modeled as R-matrix to include vertical natural focusing:
LH_UND={'un' 'LH_UND'   Lhun/2    [kqlh lam]}';
% RM(5,6) =  Lhun/2/(gami^2)*(1+(K_und^2)/2)

LSRHTR=[LHBEG,BXh1A,BXh1B,Dh01,BXh2A,BXh2B,Dh02a,OTRH1,Dh03a,LH_UND, ...
        HTRUND,LH_UND,Dh03b,OTRH2,Dh02b,BXh3A,BXh3B,Dh01, ...
        BXh4A,BXh4B,LHEND];

LINE=[Dh00,LSRHTR,Dh06];
beamLineLH=LINE';

%beamLineLH(:,[1 2 4 5])=LINE';
%beamLineLH(:,3)=num2cell(1383.859310+cumsum([LINE{3,:}]));

% GTL
% ===

  RBXG   = 0.1963;                 % BXG bend radius (measured) [m]

%  rQGx   = 0.020;                  % QG quadrupole pole-tip radius [m]
  LQGx   = 0.076;                  % QG quadrupole effective length [m]

  ABXG   = 85.0*RADDEG;            % bend angle of BXG dipole [deg*RADDEG = rad]
  EBXG   = 24.25*RADDEG;           % BXG pole-face rot. edge angle of BXG dipole [deg*RADDEG = rad]
  GBXG   = 0.043;                  % BXG magnet full gap height (m)
  LBXG   = RBXG*ABXG;              % path length of BXG dipole when ON (= R*theta) [m]

  BXGA    ={'be' 'BXG' LBXG/2 [ABXG/2 GBXG/2 EBXG 0 0.492 0 0]}';  % 1st-half of gun spectrometer bend (set to ~zero length and strength, with longitudinal position as the actual bend's center)
  BXGB    ={'be' 'BXG' LBXG/2 [ABXG/2 GBXG/2 0 EBXG 0 0.492 0]}';  % 1st-half of gun spectrometer bend (set to ~zero length and strength, with longitudinal position as the actual bend's center)

%  DXG0    ={'dr' ''    RBXG*sin(ABXG/2) []}';      % drift, w/BXG off, from BXG entrance face to its z-projected center
%  DXGA    ={'be' ''    1E-9/2 [0/2 0 0 0 0 0 0]}';   % 1st-half of gun-spec bend (set to ~zero length and strength, with longitudinal position as bend's center)
%  DXGB    ={'be' ''    1E-9/2 [0/2 0 0 0 0 0 0]}';   % 2nd-half of gun-spec bend (set to ~zero length and strength, with longitudinal position as bend's center)

  DGS1    ={'dr' ''    0.1900-LQGx/2-20E-6-0.0155757 []}';
  DGS2    ={'dr' ''    (0.2300-LQGx)/2+20E-6 []}';
  DGS3    ={'dr' ''    (0.2300-LQGx)/2-20E-6 []}';
  DGS4    ={'dr' ''    0.1680-LQGx/2-0.00283 []}';
  DGS5    ={'dr' ''    0.0300-0.02271 []}';
  DGS6    ={'dr' ''    0.0240-0.00402 []}';
  DGS7    ={'dr' ''    0.05 []}';

%  CQ01    : QUAD,L=1E-9/2,K1=0,TYPE="QSOL"                   %correction quad in 1st solenoid at gun (nominally set to 0) (set to ~zero length, with longitudinal position as the actual quad's center)
%  SQ01    : QUAD,L=1E-9/2,K1=0,TILT,TYPE="QSOL"              %correction skew-quad in 1st solenoid at gun (nominally set to 0) (set to ~zero length, with longitudinal position as the actual quad's center)
  QG02    ={'qu' 'QG02' LQGx/2 -35.48540}';
  QG03    ={'qu' 'QG03' LQGx/2  80.16051}';

  XCG1    ={'mo' 'XCG1' 0 []}';
  XCG2    ={'mo' 'XCG2' 0 []}';
  YCG1    ={'mo' 'YCG1' 0 []}';
  YCG2    ={'mo' 'YCG2' 0 []}';
  SCG1    =[XCG1,YCG1];
  SCG2    =[XCG2,YCG2];

  BPMG1   ={'mo' 'BPMG1' 0 []}';
  CRG1    ={'mo' 'CRG1'  0 []}';   % Cerenkov radiator bunch length monitor
  YAGG1   ={'mo' 'YAGG1' 0 []}';   % 6-MeV spectrometer screen
  FCG1    ={'mo' 'FCG1'  0 []}';   % gun-spec. Faraday cup w/screen
  GSPECBEG={'mo' ''      0 []}';
  DBMARK97={'mo' ''      0 []}'; %(GUNSPECT) 6 MeV gun spectrometer dump

  GSPEC   =      [GSPECBEG,BXGA,BXGB,DGS1,QG02,SCG1,QG02, ...
                  DGS2,BPMG1,DGS3,QG03,SCG2,QG03, ...
                  DGS4,YAGG1,DGS5,CRG1,DGS6,FCG1,DGS7,DBMARK97]; % gun spectrometer from BXG to Farraday cup and dump

beamLineBG=GSPEC';

% ----------------- DL1,BC1&2 -----------------------------
injdeg = -35.0;    %injector bend angle w.r.t. linac [degrees]
E00    = 0.006;    %beam energy after gun (GeV)
E0i    = 0.064;    %beam energy between L0a and L0b sections (GeV)
Ei     = 0.135;    %initial beam energy (GeV) (150->135 MeV on July 9, 2003)
EBC1   = 0.250;    %BC1 energy (GeV)
EBC2   = 4.300;    %BC2 energy (GeV)

LB0 = 0.2032;     %5D7.1 "Z" length (m)
GB0 = 30E-3;      %5D7.1 gap height (m)
LB1 = 0.2032;     %5D7.1 "Z" length (m)
GB1 = 43.28E-3;   %5D7.1 gap height (m)
LB2 = 0.5490;     %1D19.7 "Z" length (m)      %changed from 0.540 m to 0.549 on Sep. 28, '07 based on magnetic measurements - PE
GB2 = 33.35E-3;   %1D19.7 gap height (m)

%DL1_ON = 1;                      %=1: nominal LCLS with BX01/02 bend magnet DL1 power-supply is ON, =0: 135-MeV spectrometer-mode with DL1 OFF

ADL1 = injdeg*pi/180;            %injection line angle (rad)

AB0    = ADL1/2;                 %full bend angle (rad)
LeffB0 = LB0*AB0/(2*sin(AB0/2)); %full bend path length (m)
AEB0   = AB0/2;                  %edge angles

Brho1 = Cb*EBC1;            %beam rigidity at BC1 (kG-m)
BB11  = -3.555805785115;    %chicane-1 bend field (kG) - changed June 22, 2004
RB11  = Brho1/BB11;         %chicane-1 bend radius (m)
AB11  = asin(LB1/RB11);     %full chicane bend angle (rad)
AB11S = asin((LB1/2)/RB11); %"short" half chicane bend angle (rad)
LB11S = RB11*AB11S;         %"short" half chicane bend path length (m)
AB11L = AB11-AB11S;         %"long" half chicane bend angle (rad)
LB11L = RB11*AB11L;         %"long" half chicane bend path length (m)

Brho2 = Cb*EBC2;            %beam rigidity at BC2 (kG-m)
BB21  = -9.071122639275;    %chicane bend field (kG)
RB21  = Brho2/BB21;         %chicane bend radius (m)
AB21  = asin(LB2/RB21);     %full chicane bend angle (rad)
AB21S = asin((LB2/2)/RB21); %"short" half chicane bend angle (rad)
LB21S = RB21*AB21S;         %"short" half chicane bend path length (m)
AB21L = AB21-AB21S;         %"long" half chicane bend angle (rad)
LB21L = RB21*AB21L;         %"long" half chicane bend path length (m)

% ----------------- L0,L1 -----------------------------

SbandF = 2856.0;    %rf frequency (MHz)
XbandF = SbandF*4;  %X-band rf frequency (MHz)
DLWLX  = 0.5948;    %Xband structure length from input-coupler center to output-coupler center, each with tooling balls (m)
DLWL10 = 3.0441;    %"10  ft" (29 Sband wavelengths; 87 DLWG cavities)
DLWL9  = 2.8692;    %"9.41 ft" (27 1/3 Sband wavelengths; 82 DLWG cavities)
DLWL7  = 2.1694;    %"7   ft" (20 2/3 Sband wavelengths; 62 DLWG cavities)
P25    = 1;         %25% power factor
P50    = sqrt(2);   %50% power factor

% L0 energy profile (model the one 3-m L0b section only)

L0phase  = -1.1;              %L0b S-band rf phase (deg)
dEL0a    = GeV2MeV*(E0i-E00); %total L0a energy gain (MeV)
dEL0b    = GeV2MeV*(Ei-E0i);  %total L0b energy gain (MeV)
PhiL0    = L0phase/360;       %radians/2pi
gfac0    = 3.095244;          % flange-to-flange length (121.86" Oct. 18, '05) of dual-feed L0-a and L0-b RF structures [m]
gradL0a  = dEL0a/(gfac0*cos(PhiL0*2*pi));
gradL0b  = dEL0b/(gfac0*cos(PhiL0*2*pi));

% L1 energy profile

L1phase  = -25.1;             %L1 S-band rf phase (deg)
L1Xphase =-160.0;             %L1 X-band rf phase (deg)
dEL1     = GeV2MeV*(EBC1-Ei); %total L1 energy gain (MeV)
dEL1X    = 19.0;              %L1 X-band amplitude (MeV)
PhiL1    = L1phase/360;       %radians/2pi
PhiL1X   = L1Xphase/360;      %radians/2pi
gfac1    = P50*DLWL9+P25*DLWL9+P25*DLWL10;
gradL1   = (dEL1-dEL1X*cos(PhiL1X*2*pi))/(gfac1*cos(PhiL1*2*pi));

  dz_QA11   = 3.42E-3;    %quad is too far downstream when dz>0

  DAQA1 ={'dr' '' 0.033450+dz_QA11 []}';
  DAQA2 ={'dr' '' 0.033450-dz_QA11 []}';
  DAQA3 ={'dr' '' 0.033450 []}';
  DAQA4 ={'dr' '' 0.033450 []}';

  KQL1 = 3.789198342593;

%  QFL1 ={'qu' '' LQE/2 +KQL1}';
%  QDL1 ={'qu' '' LQE/2 -KQL1}';

  KQA11 = -KQL1;
  KQA12 =  1.863910872552;
  QA11 ={'qu' 'QA11' LQx/2 KQA11}';
  QA12 ={'qu' 'QA12' LQx/2 KQA12}';

  BPMA11 ={'mo' 'BPMA11'  0 []}';
  BPMA12 ={'mo' 'BPMA12'  0 []}';

  L1beg  ={'mo' 'L1BEG'   0 []}';
  L1end  ={'mo' 'L1END'   0 []}';
  ZLIN01 ={'mo' 'ZLIN01'  0 []}';

  XC11   ={'mo' 'XC11'    0 []}';

  XCA11  ={'mo' 'XCA11'   0 []}';
  XCA12  ={'mo' 'XCA12'   0 []}';       % calibrated to <1%

  XC21202={'mo' 'XC21202' 0 []}';       % pulled off structure and replaced on beamline?

  YC11   ={'mo' 'YC11'    0 []}';

  YCA11  ={'mo' 'YCA11'   0 []}';      % calibrated to <1%
  YCA12  ={'mo' 'YCA12'   0 []}';

  YC21203={'mo' 'YC21203' 0 []}';

  SC11  =[XC11,YC11];
  SCA11 =[XCA11,YCA11];
  SCA12 =[XCA12,YCA12];

% ==============================================================================
% 11-JAN-2007, P. Emma
%    Move QA11 a few mm as observed by alignment.
% 09-MAR-2006, P. Emma
%    Move SC11, SCA11, SCA12, and XC21202 and YC21203 per P. Stephens.
% 01-DEC-2005, P. Emma
%    Move XC21202 and YC21203 onto end of 21-1d.
% 29-NOV-2005, P. Emma
%    Add types for LCAV's.
% 09-NOV-2005, P. Emma
%    Use type-1 x/y corrector packages in L1-linac and relocate.
% 25-SEP-2005, P. Emma
%    Break L1 structure up to insert correctors at proper locations.
% ==============================================================================
% LCAVs
% ------------------------------------------------------------------------------
% the L1 linac consists of:   1 9.4  ft S-band sections @ 50% power
%                             1 9.4  ft S-band sections @ 25% power
%                             1 10   ft S-band sections @ 25% power
% ------------------------------------------------------------------------------
  dLb1    = 0.200+0.253432;
  dLb2    = DLWL9-dLb1;
  K21_1b1 = {'lc' 'K21_1b' dLb1 [SbandF P50*gradL1*dLb1 PhiL1*TWOPI]}';

  K21_1b2 = {'lc' 'K21_1b' dLb2 [SbandF P50*gradL1*dLb2 PhiL1*TWOPI]}';

  dLc1    = 0.200+0.2534458;
  dLc2    = DLWL9-dLc1;
  K21_1c1 = {'lc' 'K21_1c' dLc1 [SbandF P25*gradL1*dLc1 PhiL1*TWOPI]}';

  K21_1c2 = {'lc' 'K21_1c' dLc2 [SbandF P25*gradL1*dLc2 PhiL1*TWOPI]}';

  dLd1    = 0.200+0.1693348;
  dLd3    = 0.300+0.167527-0.1799554;
  dLd4    = 0.200+0.1799554;
  dLd2    = DLWL10-dLd1-dLd3-dLd4;
  K21_1d1 = {'lc' 'K21_1d' dLd1 [SbandF P25*gradL1*dLd1 PhiL1*TWOPI]}';

  K21_1d2 = {'lc' 'K21_1d' dLd2 [SbandF P25*gradL1*dLd2 PhiL1*TWOPI]}';

  K21_1d3 = {'lc' 'K21_1d' dLd3 [SbandF P25*gradL1*dLd3 PhiL1*TWOPI]}';

  K21_1d4 = {'lc' 'K21_1d' dLd4 [SbandF P25*gradL1*dLd4 PhiL1*TWOPI]}';


% ==============================================================================
% BEAMLINEs
% ------------------------------------------------------------------------------

  L1    =      [L1beg,ZLIN01, ...
                K21_1b1,SC11 ,K21_1b2, ...
                DAQA1,QA11,BPMA11,QA11,DAQA2, ...
                K21_1c1,SCA11,K21_1c2, ...
                DAQA3,QA12,BPMA12,QA12,DAQA4, ...
                K21_1d1,SCA12,K21_1d2,YC21203, ...
                K21_1d3,XC21202,K21_1d4, ...
                L1end];

% ==============================================================================

  L1X___1 ={'lc' 'L1X' DLWLX/2 [XbandF dEL1X/2 PhiL1X*TWOPI]}';
  L1X___2 ={'lc' 'L1X' DLWLX/2 [XbandF dEL1X/2 PhiL1X*TWOPI]}';

[GB0 LeffB0 AEB0 GB1 GB2 LB11S LB11L LB21S LB21L gradL0a gradL0b DLWL7];

% Define beamlines.
% beamline description {type 'MAD name' z leff [field and other params]}
% For bend                                     [angle hgap e1 e2 fint fintx roll]
% For linac                                    [freq (MHz) amp (MeV) phase (radians)]
% For undulator                                [k1 lam_u]

% Gun beamline from GUN to BXG
beamLineGB={ ...
    'dr' ''        -0.869048 []; ...
    'dr' ''         0.869048 []; ...
    'mo' 'L0BEG'    0        []; ...
    'dr' 'SOL1BK'   0        []; ...
    'mo' 'DBMARK80' 0        []; ...
    'mo' ''         0        []; ...
    'dr' ''         0.096010 []; ...
    'dr' 'SOL1'     0.1      []; ...
    'dr' 'CQ01'     0        []; ...
    'dr' 'CQ01'     0        []; ...
    'mo' 'XC00'     0        []; ...
    'mo' 'YC00'     0        []; ...
    'dr' 'SQ01'     0        []; ...
    'dr' 'SQ01'     0        []; ...
    'dr' 'SOL1'     0.1      []; ...
    'dr' ''         0.078510 []; ...
    'mo' 'VV01'     0        []; ...
    'dr' ''         0.116090 []; ...
    'mo' 'AM00'     0        []; ...
    'dr' ''         0.104610 []; ...
    'mo' 'AM01'     0        []; ...
    'dr' ''         0.018400 []; ...
    'mo' 'YAG01'    0        []; ...
    'dr' ''         0.010970 []; ...
    'mo' 'FC01'     0        []; ...
    'dr' ''         0.082500 []; ...
    'mo' 'IM01'     0        []; ...
    'dr' ''         0.127295 []; ...
    'mo' 'XC01'     0        []; ...
    'mo' 'YC01'     0        []; ...
    'dr' ''         0.0581886 []; ...
    'mo' 'BPM2'     0        []; ...
    'dr' ''         0.085270 []; ...
    'mo' 'DBMARK81' 0        []; ...
    };

% Gun beamline from BXG to L0A
beamLineGN={ ...
    'dr' ''         0.132619 []; ... % BXG
    'dr' ''         0        []; ... % BXG
    'dr' ''         0        []; ... % BXG
    'dr' ''         0.106197 []; ...
    'mo' 'BPM3'     0        []; ...
    'dr' ''         0.142380 []; ...
    'mo' 'CR01'     0        []; ...
    'dr' ''         0.029370 []; ...
    'mo' 'YAG02'    0        []; ...
    'dr' ''         0.070590 []; ...
    'mo' 'ZLIN00'   0        []; ...
    'mo' 'FLNGa1'   0        []; ...
    'lc' 'L0A'      0.058646 [2856.0  1.099136 -1.1*pi/180]; ...
    'mo' 'DLFDa'    0        []; ...
    'lc' 'L0A'      0.199354 [2856.0  3.736269 -1.1*pi/180]; ...
    'mo' 'SOL2'     0        []; ...
    'lc' 'L0A'      0.649320 [2856.0 12.169474 -1.1*pi/180]; ...
    'mo' 'XC02'     0        []; ...
    'mo' 'YC02'     0        []; ...
    'lc' 'L0A'      0.640302 [2856.0 12.000467 -1.1*pi/180]; ...
    'mo' 'L0AMID'   0        []; ...
    'lc' 'L0A'      1.151846 [2856.0 21.587767 -1.1*pi/180]; ...
    'mo' 'XC03'     0        []; ...
    'mo' 'YC03'     0        []; ...
    'lc' 'L0A'      0.334857 [2856.0  6.275842 -1.1*pi/180]; ...
    'mo' 'OUTCPa'   0        []; ...
    'lc' 'L0A'      0.060919 [2856.0  1.141737 -1.1*pi/180]; ...
    'mo' 'FLNGa2'   0        []; ...
    'mo' 'L0AWAKE'  0        []; ...
    'mo' 'L0BBEG'   0        []; ...
    };

% Injector beamline from YAG03 to QM02
beamLineIN=[{ ...
    'dr' ''         0.060295 []; ...
    'mo' 'YAG03'    0        []; ...
    'dr' ''         0.112785 []; ...
    'dr' ''         0.073610 []; ...
    'qu' 'QA01'     0.0540   -12.317411498864; ...
    'qu' 'QA01'     0.0540   -12.317411498864; ...
    'dr' ''         0.094484 []; ...
    'mo' 'PH01'     0        []; ...
    'dr' ''         0.125892 []; ...
    'qu' 'QA02'     0.0540   13.706906173749; ...
    'mo' 'BPM5'     0        []; ...
    'qu' 'QA02'     0.0540   13.706906173749; ...
    'dr' ''         0.065888 []; ...
    'mo' 'FLNGb1'   0        []; ...
    'lc' 'L0B'      0.058646 [2856.0  1.345494 -1.1*pi/180]; ...
    'mo' 'DLFDb'    0        []; ...
    'lc' 'L0B'      0.337128 [2856.0  7.734608 -1.1*pi/180]; ...
    'mo' 'XC04'     0        []; ...
    'mo' 'YC04'     0        []; ...
    'lc' 'L0B'      1.151848 [2856.0 26.426441 -1.1*pi/180]; ...
    'mo' 'L0BMID'   0        []; ...
    'lc' 'L0B'      1.151563 [2856.0 26.419902 -1.1*pi/180]; ...
    'mo' 'XC05'     0        []; ...
    'mo' 'YC05'     0        []; ...
    'lc' 'L0B'      0.335140 [2856.0  7.688998 -1.1*pi/180]; ...
    'mo' 'OUTCPb'   0        []; ...
    'lc' 'L0B'      0.060919 [2856.0  1.397643 -1.1*pi/180]; ...
    'mo' 'FLNGb2'   0        []; ...
    'mo' 'L0END'    0        []; ...
    'mo' 'EMAT'     0        []; ...
    'mo' 'DL1BEG'   0        []; ...
    'dr' ''         0.024994 []; ...
    'dr' ''         0.016613 []; ...
    'qu' 'QE01'     0.0540   -6.538179321052; ...
    'mo' 'BPM6'     0        []; ...
    'qu' 'QE01'     0.0540   -6.538179321052; ...
    'dr' ''         0.076373 []; ...
    'mo' 'IM02'     0        []; ...
    'dr' ''         0.122359 []; ...
    'mo' 'VV02'     0        []; ...
    'dr' ''         0.094781 []; ...
    'qu' 'QE02'     0.0540   5.354060093454; ...
    'qu' 'QE02'     0.0540   5.354060093454; ...
    }; ...
%    'dr' ''         1.277144 []; ...
%    'mo' 'YAG04'    0        []; ...
%    'dr' ''         0.582877 []; ...
    beamLineLH                           ; ...
    { ...
    'tc' 'TCAV0'    0.334012 [2856.0 0 90*pi/180 pi/2]; ...
    'mo' 'XC06'     0        []; ...
    'mo' 'YC06'     0        []; ...
    'tc' 'TCAV0'    0.334011 [2856.0 0 90*pi/180 pi/2]; ...
    'dr' ''         0.035740 []; ...
    'qu' 'QE03'     0.0540   6.054674881291; ...
    'mo' 'BPM8'     0        []; ...
    'qu' 'QE03'     0.0540   6.054674881291; ...
    'dr' ''         0.114320 []; ...
    'dr' ''         0.047581 []; ...
    'mo' 'XC07'     0        []; ...
    'mo' 'YC07'     0        []; ...
    'dr' ''         0.136499 []; ...
    'qu' 'QE04'     0.0540   -5.235476556481; ...
    'mo' 'BPM9'     0        []; ...
    'qu' 'QE04'     0.0540   -5.235476556481; ...
    'dr' ''         0.143688 []; ...
    'mo' 'WS01'     0        []; ...
    'dr' ''         0.151968 []; ...
    'mo' 'OTR1'     0        []; ...
    'dr' ''         0.104470 []; ...
    'mo' 'VV03'     0        []; ...
    'dr' ''         1.409489 []; ...
    'mo' 'RST1'     0        []; ...
    'dr' ''         0.247802 []; ...
    'mo' 'WS02'     0        []; ...
    'dr' ''         0.075984 []; ...
    'mo' 'MRK0'     0        []; ...
    'dr' ''         0.075984 []; ...
    'mo' 'OTR2'     0        []; ...
    'dr' ''         0.163831 []; ...
    'mo' 'BPM10'    0        []; ...
    'dr' ''         1.597930 []; ...
    'mo' 'WS03'     0        []; ...
    'dr' ''         0.151968 []; ...
    'mo' 'OTR3'     0        []; ...
    'dr' ''         0.150806 []; ...
    'qu' 'QM01'     0.0540   15.072053882204; ...
    'mo' 'BPM11'    0        []; ...
    'qu' 'QM01'     0.0540   15.072053882204; ...
    'dr' ''         0.147872 []; ...
    'mo' 'XC08'     0        []; ...
    'mo' 'YC08'     0        []; ...
    'dr' ''         0.183330 []; ...
    'mo' 'VV04'     0        []; ...
    'dr' ''         0.116620 []; ...
    'qu' 'QM02'     0.0540   -11.974604636345; ...
    'mo' 'BPM12'    0        []; ...
    'qu' 'QM02'     0.0540   -11.974604636345; ...
    'dr' ''         0.223450 []; ...
    'mo' 'DBMARK82' 0        []; ...
    }];

% DL1 beamline from BX01 to QM04
beamLineDL={ ...
    'be' 'BX01'     0.101996 [-8.75*pi/180 0.015 -8.75*pi/180 0           0.45 0 0]; ...
    'be' 'BX01'     0.101996 [-8.75*pi/180 0.015  0          -8.75*pi/180 0 0.45 0]; ...
    'dr' ''         0.399700 []; ...
    'mo' 'OTR4'     0        []; ...
    'dr' ''         0.161000 []; ...
    'mo' 'XC09'     0        []; ...
    'mo' 'YC09'     0        []; ...
    'dr' ''         0.165700 []; ...
    'qu' 'QB'       0.0534   22.169701529353; ...
    'mo' 'BPM13'    0        []; ...
    'qu' 'QB'       0.0534   22.169701529353; ...
    'dr' ''         0.288600 []; ...
    'mo' 'WS04'     0        []; ...
    'dr' ''         0.437800 []; ...
    'be' 'BX02'     0.101996 [-8.75*pi/180 0.015 -8.75*pi/180 0           0.45 0 0]; ...
    'be' 'BX02'     0.101996 [-8.75*pi/180 0.015  0          -8.75*pi/180 0 0.45 0]; ...
    'mo' 'CNT0'     0        []; ...
    'mo' 'DBMARK83' 0        []; ...
    'dr' ''         0.221300 []; ...
    'mo' 'XC10'     0        []; ...
    'mo' 'YC10'     0        []; ...
    'dr' ''         0.140683 []; ...
    'qu' 'QM03'     0.0540   -8.255421303054; ...
    'mo' 'BPM14'    0        []; ...
    'qu' 'QM03'     0.0540   -8.255421303054; ...
    'dr' ''         0.088367 []; ...
    'dr' ''         0.208800 []; ...
    'qu' 'QM04'     0.0540   13.306105246908; ...
    'mo' 'BPM15'    0        []; ...
    'qu' 'QM04'     0.0540   13.306105246908; ...
    'dr' ''         0.1402   []; ...
    'mo' 'IM03'     0        []; ...
    'dr' ''         0.157448 []; ...
    };

% Injector spectrometer beamline from BX01 to OTRS1
beamLineSP={ ...
    'mo' 'SPECBEG'  0        []; ...
    'dr' 'BX01'     0.1016   []; ... % BX01
    'dr' 'BX01'     0.1016   []; ... % BX01
    'dr' ''         0.558399 []; ...
    'mo' 'XCS1'     0        []; ...
    'mo' 'YCS1'     0        []; ...
    'dr' ''         0.1691504 []; ...
    'dr' ''         0.230750 []; ...
    'dr' ''         0.0890085 []; ...
    'mo' 'VVS1'     0        []; ...
    'dr' ''         0.145122 []; ...
    'mo' 'YAGS1'    0        []; ...
    'dr' ''         0.171796 []; ...
    'mo' 'BPMS1'    0        []; ...
    'dr' ''         0.251824 []; ...
    'be' 'BXS'      0.27175  [-17.5*pi/180 0.017 -7.29*pi/180  0           0.391 0 0]; ...
    'be' 'BXS'      0.27175  [-17.5*pi/180 0.017  0           -7.29*pi/180 0 0.391 0]; ...
    'dr' ''         0.478250 []; ...
    'qu' 'QS01'     0.0540   9.682244191676; ...
    'mo' 'BPMS2'    0        []; ...
    'qu' 'QS01'     0.0540   9.682244191676; ...
    'dr' ''         0.199626 []; ...
    'mo' 'XCS2'     0        []; ...
    'mo' 'YCS2'     0        []; ...
    'dr' ''         0.200374 []; ...
    'qu' 'QS02'     0.0540   -5.648980372134; ...
    'qu' 'QS02'     0.0540   -5.648980372134; ...
    'dr' ''         0.287275 []; ...
    'mo' 'IMS1'     0        []; ...
    'dr' ''         0.257595 []; ...
    'mo' 'BPMS3'    0        []; ...
    'dr' ''         0.219125 []; ...
    'mo' 'YAGS2'    0        []; ...
    'dr' ''         0.368392 []; ...
    'mo' 'OTRS1'    0        []; ...
    'dr' ''         0.2176126 []; ...
    'dr' ''         0.3378194 []; ...
    'mo' 'SDMP'     0        []; ...
    'mo' 'DBMARK98' 0        []; ...
    };

% BC1 beamline from Q21201 to TD11
beamLineL1=[{ ...
    'dr' ''         0         []; ...
%{
    'mo' 'ZLIN01'   0        []; ...
    'lc' 'L1S'      0.453432 [2856.0  9.435042 -25.1*pi/180]; ...
    'mo' 'XC11'     0        []; ...
    'mo' 'YC11'     0        []; ...
    'lc' 'L1S'      2.415768 [2856.0 50.267453 -25.1*pi/180]; ...
    'dr' ''         0.036870 []; ...
    'qu' 'QA11'     0.0540   -3.789198342593; ...
    'mo' 'BPMA11'   0        []; ...
    'qu' 'QA11'     0.0540   -3.789198342593; ...
    'dr' ''         0.030030 []; ...
    'lc' 'L1S'      0.453446 [2856.0  6.671785 -25.1*pi/180]; ...
    'mo' 'XCA11'    0        []; ...
    'mo' 'YCA11'    0        []; ...
    'lc' 'L1S'      2.415754 [2856.0 35.544254 -25.1*pi/180]; ...
    'dr' ''         0.033450 []; ...
    'qu' 'QA12'     0.0540   1.863910872552; ...
    'mo' 'BPMA12'   0        []; ...
    'qu' 'QA12'     0.0540   1.863910872552; ...
    'dr' ''         0.033450 []; ...
    'lc' 'L1S'      0.369335 [2856.0  5.434216 -25.1*pi/180]; ...
    'mo' 'XCA12'    0        []; ...
    'mo' 'YCA12'    0        []; ...
    'lc' 'L1S'      2.007238 [2856.0 29.533545 -25.1*pi/180]; ...
    'mo' 'YC21203'  0        []; ...
    'lc' 'L1S'      0.287572 [2856.0  4.231191 -25.1*pi/180]; ...
    'mo' 'XC21202'  0        []; ...
    'lc' 'L1S'      0.379955 [2856.0  5.590482 -25.1*pi/180]; ...
%}
    }; ...
    L1'                         ; ...
    { ...
    'mo' 'BC1MRK'   0        []; ...
    'dr' ''         0.093369 []; ...
    'mo' 'VVX1'     0        []; ...
    'dr' ''         0.2      []; ...
    'mo' 'XBEG'     0        []; ...
    }; ...
    L1X___1'                    ; ...
%    'lc' 'L1X'      0.2974   [11424.0  9.5 -160*pi/180]; ...
    { ...
    'mo' 'XCM11'    0        []; ...
    'mo' 'YCM11'    0        []; ...
    }; ...
    L1X___2'                    ; ...
%    'lc' 'L1X'      0.2974   [11424.0  9.5 -160*pi/180]; ...
    { ...
    'mo' 'XEND'     0        []; ...
    }];

beamLineBC1={ ...
    'dr' ''         0.205078 []; ...
    'mo' 'VVX2'     0        []; ...
    'dr' ''         0.119932 []; ...
    'qu' 'Q21201'   0.0534   -9.357677119503; ...
    'mo' 'BPM21201' 0        []; ...
    'mo' 'ZLIN02'   0        []; ...
    'qu' 'Q21201'   0.0534   -9.357677119503; ...
    'dr' ''         0.086007 []; ...
    'mo' 'IMBC1I'   0        []; ...
    'dr' ''         0.278883 []; ...
    'qu' 'QM11'     0.0540   7.960339117021; ...
    'qu' 'QM11'     0.0540   7.960339117021; ...
    'dr' ''         0.127801 []; ...
    'mo' 'BC1BEG'   0        []; ...
    'be' 'BX11'     0.101631807854420 [-0.043335955580683 0.02164  0  0                 0.387 0 0]; ...
    'be' 'BX11'     0.101823302791611 [-0.043417609309640 0.02164  0 -0.086753564890323 0 0.387 0]; ...
    'dr' ''         0.245705 []; ...
    'qu' 'CQ11'     0.0540   0; ...
    'qu' 'CQ11'     0.0540   0; ...
    'dr' ''         2.090386 []; ...
    'be' 'BX12'     0.101823302791611 [ 0.043417609309640 0.02164  0.086753564890323  0 0.387 0 0]; ...
    'be' 'BX12'     0.101631807854420 [ 0.043335955580683 0.02164  0                  0 0 0.387 0]; ...
    'dr' ''         0.248640 []; ...
    'mo' 'BPMS11'   0        []; ...
    'dr' ''         0.164460 []; ...
    'mo' 'CE11'     0        []; ...
    'dr' ''         0.182606 []; ...
    'mo' 'OTR11'    0        []; ...
    'dr' ''         0.234494 []; ...
    'be' 'BX13'     0.101631807854420 [ 0.043335955580683 0.02164  0  0                 0.387 0 0]; ...
    'be' 'BX13'     0.101823302791611 [ 0.043417609309640 0.02164  0  0.086753564890323 0 0.387 0]; ...
    'dr' ''         0.262287 []; ...
    'qu' 'SQ13'     0.0800   [0 pi/4]; ...
    'qu' 'SQ13'     0.0800   [0 pi/4]; ...
    'dr' ''         1.6681   []; ...
    'qu' 'CQ12'     0.0540   0; ...
    'qu' 'CQ12'     0.0540   0; ...
    'dr' ''         0.245705 []; ...
    'be' 'BX14'     0.101823302791611 [-0.043417609309640 0.02164 -0.086753564890323  0 0.387 0 0]; ...
    'be' 'BX14'     0.101631807854420 [-0.043335955580683 0.02164  0                  0 0 0.387 0]; ...
    'mo' 'CNT1'     0        []; ...
    'mo' 'BC1END'   0        []; ...
    'dr' ''         0.161725 []; ...
    'mo' 'BL11'     0        []; ...
    'dr' ''         0.161725 []; ...
    'qu' 'QM12'     0.0540   -8.366726970987; ...
    'qu' 'QM12'     0.0540   -8.366726970987; ...
    'dr' ''         0.173850 []; ...
    'dr' ''         0.20713875 []; ...
    'mo' 'IMBC1O'   0        []; ...
    'dr' ''         0.181789 []; ...
    'qu' 'QM13'     0.0540   9.860390676906; ...
    'mo' 'BPMM12'   0        []; ...
    'qu' 'QM13'     0.0540   9.860390676906; ...
    'dr' ''         0.100472 []; ...
    'mo' 'BL12'     0        []; ...
    'dr' ''         0.201074 []; ...
    'mo' 'XCM13'    0        []; ...
    'mo' 'YCM12'    0        []; ...
    'dr' ''         0.235    []; ...
    'mo' 'WS11'     0        []; ...
    'dr' ''         1.656196 []; ...
    'mo' 'WS12'     0        []; ...
    'dr' ''         0.295000 []; ...
    'mo' 'OTR12'    0        []; ...
    'dr' ''         0.415330 []; ...
    'mo' 'PH02'     0        []; ...
    'dr' ''         0.302401 []; ...
    'mo' 'XC21302'  0        []; ...
    'dr' ''         0.346099 []; ...
    'mo' 'YC21303'  0        []; ...
    'dr' ''         0.297366 []; ...
    'mo' 'WS13'     0        []; ...
    'dr' ''         0.255730 []; ...
    'qu' 'Q21301'   0.0534   -0.1347; ... % turn this quad OFF for LCLS operations (this is meas'd remnant field of Gdl = 0.12 kG)
    'mo' 'BPM21301' 0        []; ...
    'mo' 'ZLIN03'   0        []; ...
    'qu' 'Q21301'   0.0534   -0.1347; ...
    'dr' ''         0.2601041 []; ...
    'dr' ''         0.4008829 []; ...
    'mo' 'TD11'     0        []; ...
    'dr' ''         0.387587 []; ...
    'qu' 'QM14'     0.0540   7.079239169293; ...
    'mo' 'BPMM14'   0        []; ...
    'qu' 'QM14'     0.0540   7.079239169293; ...
    'dr' ''         0.226130 []; ...
    'mo' 'XCM14'    0        []; ...
    'mo' 'YCM15'    0        []; ...
    'dr' ''         0.230680 []; ...
    'qu' 'QM15'     0.0540   -6.765038435385; ...
    'qu' 'QM15'     0.0540   -6.765038435385; ...
    'mo' 'DBMARK28' 0        []; ...
    'dr' ''         0.096920 []; ...
    'mo' 'BC1FIN'   0        []; ...
    };

% BC1 beamline from Q21201 to TD11
beamLineBC2={ ...
    'mo' 'BC2MRK'   0        []; ...
    'dr' ''         0.0342   []; ...
    'qu' 'Q24701A'  0.0534   -1.286030138047; ...
    'mo' 'ZLIN08'   0        []; ...
    'qu' 'Q24701A'  0.0534   -1.286030138047; ...
    'dr' ''         0.127    []; ...
    'qu' 'Q24701B'  0.0534   -1.286030138047; ...
    'mo' 'BPM24701' 0        []; ...
    'qu' 'Q24701B'  0.0534   -1.286030138047; ...
    'dr' ''         0.0828006-0.027 []; ...
    'dr' ''         0.3238194-0.022319 []; ...
    'mo' 'WS24'     0        []; ...
    'dr' ''         0.18918+0.022319 []; ...
    'mo' 'IMBC2I'   0        []; ...
    'dr' ''         0.6340002 []; ...
    'mo' 'VV21'     0        []; ...
    'dr' ''         0.3202404 []; ...
    'qu' 'QM21'     0.230460 0.508115309359; ...
    'qu' 'QM21'     0.230460 0.508115309359; ...
    'dr' ''         0.139536 []; ...
    'dr' ''         0.1996034-0.0045 []; ...
    'mo' 'BC2BEG'   0        []; ...
    'be' 'BX21'     0.274513789904970 [-0.017361108510954 0.016675  0  0                 0.633 0 0]; ...
    'be' 'BX21'     0.274596574253480 [-0.017366344051427 0.016675  0 -0.034727452562382 0 0.633 0]; ...
    'dr' ''         1.956680 []; ...
    'qu' 'CQ21'     0.0540   0; ...
    'qu' 'CQ21'     0.0540   0; ...
    'dr' ''         7.801469 []; ...
    'be' 'BX22'     0.274596574253480 [ 0.017366344051427 0.016675  0.034727452562382  0 0.633 0 0]; ...
    'be' 'BX22'     0.274513789904970 [ 0.017361108510954 0.016675  0                  0 0 0.633 0]; ...
    'dr' ''         0.131185 []; ...
    'dr' ''         0.248640 []; ...
    'mo' 'BPMS21'   0        []; ...
    'dr' ''         0.164460 []; ...
    'mo' 'CE21'     0        []; ...
    'dr' ''         0.182606 []; ...
    'mo' 'OTR21'    0        []; ...
    'dr' ''         0.234494 []; ...
    'dr' ''         0.131215 []; ...
    'be' 'BX23'     0.274513789904970 [ 0.017361108510954 0.016675  0  0                 0.633 0 0]; ...
    'be' 'BX23'     0.274596574253480 [ 0.017366344051427 0.016675  0  0.034727452562382 0 0.633 0]; ...
    'dr' ''         7.801469 []; ...
    'qu' 'CQ22'     0.0540   0; ...
    'qu' 'CQ22'     0.0540   0; ...
    'dr' ''         1.956680 []; ...
    'be' 'BX24'     0.274596574253480 [-0.017366344051427 0.016675 -0.034727452562382  0 0.633 0 0]; ...
    'be' 'BX24'     0.274513789904970 [-0.017361108510954 0.016675  0                  0 0 0.633 0]; ...
    'mo' 'CNT2'     0        []; ...
    'mo' 'BC2END'   0        []; ...
    'dr' ''         0.3065   []; ...
    'dr' ''         0.2087   []; ...
    'mo' 'BL21'     0        []; ...
    'dr' ''         0.114235 []; ...
    'dr' ''         0.050405 []; ...
    'qu' 'QM22'     0.230460 -0.590418980634; ...
    'qu' 'QM22'     0.230460 -0.590418980634; ...
    'dr' ''         0.129440 []; ...
    'mo' 'VV22'     0        []; ...
    'dr' ''         0.1780   []; ...
    'dr' ''         0.0707   []; ...
    'qu' 'Q24901A'  0.0534   1.082042245094; ...
    'mo' 'BPM24901' 0        []; ...
    'qu' 'Q24901A'  0.0534   1.082042245094; ...
    'dr' ''         0.1063   []; ...
    'qu' 'Q24901B'  0.0534   1.082042245094; ...
    'qu' 'Q24901B'  0.0534   1.082042245094; ...
    'dr' ''         0.1604   []; ...
    'mo' 'BC2FIN'   0        []; ...
    };

beamLine=[];
if ismember('ALL',region)
    beamLine.IN=[beamLineGB;beamLineGN;beamLineIN];
    beamLine.GS=[beamLineGB;beamLineBG];
    beamLine.DL=beamLineDL;
    beamLine.SP=beamLineSP;
    beamLine.B1=[beamLineL1;beamLineBC1];
    beamLine.B2=beamLineBC2;
else
    if ismember('IN',region), beamLine=[beamLine;beamLineGB;beamLineGN;beamLineIN];end
    if ismember('GS',region), beamLine=[beamLine;beamLineGB;beamLineBG];end
    if ismember('DL',region), beamLine=[beamLine;beamLineDL];end
    if ismember('SP',region), beamLine=[beamLine;beamLineSP];end
    if ismember('BC1',region), beamLine=[beamLine;beamLineL1;beamLineBC1];end
    if ismember('BC2',region), beamLine=[beamLine;beamLineBC2];end
end
if isempty(beamLine), beamLine=beamLineIN;end
