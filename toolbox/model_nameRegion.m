function [name, id, isSLC] = model_nameRegion(prim, region, varargin)

% [NAME, ID, ISSLC] = MODEL_NAMEREGION(PRIM, REGION, OPTS) Finds all MAD
% names with primaries PRIM in regions REGION, e.g. {'L2' 'L3'}. Option LEM
% selects only LEM'd devices, i.e. excludes UNDH,UNDS and BXG/BX0.
%
% Top level retions are SC_SXR, SC_SFTS, SC_SXTES, SC_HXR, SC_BSYD,
% SC_DIAG0, SC_DASEL, CU_HXR, CU_SFTH, CU_HXTES, CU_SXR, CU_ALINE,
% CU_GSPEC, CU_SPEC, F2_ELEC, F2_SCAV, F2_POSI
%
% Elementary regions are GUNB, L0B, HTR, COL0, L1B, BC1B, COL1,
% L2B, BC2B, EMIT2, L3B, EXT, DOG, BYP, SPD_1, SPS, SLTS, BSYS,
% LTUS, UNDS, DMPS_1, DMPS_2, SFTS_1, SFTS_2, SXTES, SPH, SLTH,
% BSYH_1, BSYH_2, LTUH, UNDH, DMPH_1, DMPH_2, SPD_2, SPD_3, SLTD,
% DIAG0, DASEL, BSYA_2, GUN, L0, DL1_1, DL1_2, L1, BC1, L2, BC2, 
%  L3, CLTH_0, CLTH_1, CLTH_2, SFTH_1, SFTH_2, HXTES, CLTS, BSYA_1, 
%  GSPEC, SPEC, INJ, DL10, L1F, BC11_1, BC11_2, L2F, BC14_1, BC14E, 
%  BC14_2, L3F_1, L3F_2, BC20, FF20, EXPT20, SPECT20, SCAV, BC14P
%
% LCLS Classic regions are preseved when not in conflict:
%   
% Top LCLS Classic regions are GN, SP, L0, L1, L2, L3, LTU, L3-BSY, 52, A-Line
% Elementary regions are Cath_BXG BXG_BX01 BXG_FCG1 BX01_BX02 BX01_SAB
% BX02_QM15 QM15_BC2 BC2 BC2_L3END L3END_50B1 50B1_DMP 50B1_SL2 50B1_ESA.
%
% Micro level regions are any micro which MODEL_NAMECONVERT knows. Any of
% the regions can be combined in the query. Additionally, micro subranges
% can be specified with <micro>:<start-1>:<end> to only include unit
% numbers from <start> to <end>. For only a single unit number <end> use
% <micro>:<end> as a shortcut.
%
% Input arguments:
%    PRIM:   Char or cellstr (array) of primary names, e.g. 'QUAD', default
%            is BEND, BTRM, BNDS, KICK, QUAD, QTRM, QUAS, XCOR, YCOR
%    REGION: Optional parameter for accelerator areas, default full, e.g. 'L2'
%    OPTS:   Options
%            LEM: Default 0, if 1, deselect non LEM devices, i.e. UND1
%            TYPE: Name type(s) to return, default [] (='EPICS').
%
% Output arguments:
%    NAME:  Cellstring of names matching PRIM and region
%    ID:    Array indicating index of matching PRIM for each NAME
%    ISSLC: Logical array indicating if device is SLC controlled

% Compatibility: Version 7 and higher
% Called functions: util_parseOptions, model_nameConvert, model_nameSplit
%
% Author: Henrik Loos, SLAC
% Modified: William Colocho, October 2019 add LCLS2 Cu 
% Modified: Greg White, 18-Apr-17
%           Spring 2017 BSY recofig in prep for LCLS-2. Per MAD 
%           release 27JAN17.
% --------------------------------------------------------------------
% Set default options.
optsdef=struct( ...
    'LEM',0, ...
    'type','EPICS' ...
    );

% Use default options if OPTS undefined.
opts=util_parseOptions(varargin{:},optsdef);
opts.type=cellstr(opts.type);

if nargin < 1, prim=[];end
if nargin < 2, region=[];end
%if isempty(prim), prim={'*'};end
if isempty(prim), prim={'BEND' 'BTRM' 'BNDS' 'KICK' 'QUAD' 'QTRM' 'QUAS' 'XCOR' 'YCOR'};end
if isempty(region), region='LCLS';end

region=reshape(cellstr(region),1,[]);
prim=cellstr(prim);
% Specify beam lines  [see model_beamlineLCLS2cu.m]



%Specify beam lines
beamLines={ ...
    'LCLS'   {'Cath_BXG' 'BXG_BX01' 'BX01_BX02' 'BX02_QM15' 'QM15_BC2' ...
              'BC2' 'BC2_L3END' 'L3END_50B1' '50B1_DMP'}; ...
    'GN'     {'Cath_BXG' 'BXG_FCG1'}; ...
    'SP'     {'Cath_BXG' 'BXG_BX01' 'BX01_SAB'}; ...
    'L0'     {'Cath_BXG' 'BXG_BX01' 'BX01_BX02'}; ...
    'L1'     {'BX02_QM15'}; ...
    'L2'     {'QM15_BC2'}; ...
    'L3'     {'BC2' 'BC2_L3END' 'L3END_50B1' 'CLTH_0' 'CLTH_1' }; ...
    'LTU'    {'50B1_DMP'}; ...
    'LTUH_DMPH' { 'CLTH_2' 'BSYH_1' 'BSYH_2' 'LTUH' 'UNDH' 'DMPH_1' 'DMPH_2' };...
    'LTUS_DMPS' { 'CLTS' 'BSYS' 'LTUS' 'UNDS' 'DMPS_1' 'DMPS_2' }; ...          
    'L3-BSY' {'BC2' 'BC2_L3END' 'L3END_50B1' '50B1_DMP'}; ...
    '52'     {'50B1_SL2'}; ...
    'A-Line' {'50B1_ESA'}; ...
    'BSY'    {'L3END_50B1' '50B1_BSY'}; ...
    'FACET'  {'DR13' 'LI02_LI10' 'LI11_LI20'}; ...
    'SC_SXR' {'GUNB' 'L0B' 'HTR' 'COL0' 'L1B' 'BC1B' 'COL1' 'L2B' 'BC2B' 'EMIT2' ...
              'L3B' 'EXT' 'DOG' 'BYP' 'SPD_1' 'SPS' 'SLTS' 'BSYS' 'LTUS' 'UNDS' 'DMPS_1' 'DMPS_2' }; ...
    'SC_SFTS' {'GUNB' 'L0B' 'HTR' 'COL0' 'L1B' 'BC1B' 'COL1' 'L2B' 'BC2B' 'EMIT2' 'L3B' 'EXT' 'DOG' ...
               'BYP' 'SPD_1' 'SPS' 'SLTS' 'BSYS' 'LTUS' 'UNDS' 'DMPS_1' 'SFTS_1' 'SFTS_2' }; ...
   'SC_SXTES' {'GUNB' 'L0B' 'HTR' 'COL0' 'L1B' 'BC1B' 'COL1' 'L2B' 'BC2B' 'EMIT2' 'L3B' 'EXT' ...
               'DOG' 'BYP' 'SPD_1' 'SPS' 'SLTS' 'BSYS' 'LTUS' 'UNDS' 'DMPS_1' 'SFTS_1' 'SXTES' }; ...
   'SC_HXR'   {'GUNB' 'L0B' 'HTR' 'COL0' 'L1B' 'BC1B' 'COL1' 'L2B' 'BC2B' 'EMIT2' 'L3B' 'EXT' 'DOG' ...
               'BYP' 'SPH' 'SLTH' 'BSYH_1' 'BSYH_2' 'LTUH' 'UNDH' 'DMPH_1' 'DMPH_2' }; ...
   'SC_BSYD'  {'GUNB' 'L0B' 'HTR' 'COL0' 'L1B' 'BC1B' 'COL1' 'L2B' 'BC2B' 'EMIT2' 'L3B' 'EXT' 'DOG' ...
               'BYP' 'SPD_1' 'SPD_2' 'SPD_3' 'SLTD' }; ...
   'SC_DIAG0' {'GUNB' 'L0B' 'HTR' 'DIAG0' }; ...
   'SC_DASEL' {'GUNB' 'L0B' 'HTR' 'COL0' 'L1B' 'BC1B' 'COL1' 'L2B' 'BC2B' 'EMIT2' 'L3B' 'EXT' 'DOG' ...
               'BYP' 'SPD_1' 'SPD_2' 'DASEL' 'BSYA_2' }; ...
   'CU_HXR'   {'GUN' 'L0' 'DL1_1' 'DL1_2' 'L1' 'BC1' 'L2' 'BC2' 'L3' 'CLTH_0' 'CLTH_1' 'CLTH_2' ...
               'BSYH_1' 'BSYH_2' 'LTUH' 'UNDH' 'DMPH_1' 'DMPH_2' }; ...
   'CU_SFTH'  {'GUN' 'L0' 'DL1_1' 'DL1_2' 'L1' 'BC1' 'L2' 'BC2' 'L3' 'CLTH_0' 'CLTH_1' 'CLTH_2' ...
               'BSYH_1' 'BSYH_2' 'LTUH' 'UNDH' 'DMPH_1' 'SFTH_1' 'SFTH_2' }; ...
   'CU_HXTES' {'GUN' 'L0' 'DL1_1' 'DL1_2' 'L1' 'BC1' 'L2' 'BC2' 'L3' 'CLTH_0' 'CLTH_1' 'CLTH_2' ...
               'BSYH_1' 'BSYH_2' 'LTUH' 'UNDH' 'DMPH_1' 'SFTH_1' 'HXTES' }; ...
   'CU_SXR'   {'GUN' 'L0' 'DL1_1' 'DL1_2' 'L1' 'BC1' 'L2' 'BC2' 'L3' 'CLTH_0' 'CLTH_1' 'CLTS' ...
               'BSYS' 'LTUS' 'UNDS' 'DMPS_1' 'DMPS_2' }; ...
   'CU_ALINE' {'GUN' 'L0' 'DL1_1' 'DL1_2' 'L1' 'BC1' 'L2' 'BC2' 'L3' 'CLTH_0' 'CLTH_1' 'CLTH_2' ...
               'BSYH_1' 'BSYA_1' 'BSYA_2' }; ...
   'CU_GSPEC' {'GUN' 'GSPEC' }; ...
   'CU_SPEC'  {'GUN' 'L0' 'DL1_1' 'SPEC' }; ...
   'F2_ELEC'  {'INJ' 'DL10' 'L1F' 'BC11_1' 'BC11_2' 'L2F' 'BC14_1' 'BC14E' 'BC14_2' 'L3F_1' ...
               'L3F_2' 'BC20' 'FF20' 'EXPT20' 'SPECT20' }; ...
   'F2_SCAV'  {'INJ' 'DL10' 'L1F' 'BC11_1' 'BC11_2' 'L2F' 'BC14_1' 'BC14E' 'BC14_2' 'L3F_1' 'SCAV' }; ...
   'F2_POSI'  {'BC11_2' 'L2F' 'BC14_1' 'BC14P' 'BC14_2' 'L3F_1' 'L3F_2' 'BC20' 'FF20' 'EXPT20' ...
               'SPECT20' } };

[d,id]=ismember(region(:),beamLines(:,1));
region=[region(~d) beamLines{id(d),2}];

% Specify each region by list of micros and unit number range within micro
% Range can also be specified with device names. Lower unit is excluded,
% higher unit is included to use same device or unit as split point.
% Regions do not have common elements.

% {Section [micro unit_start unit_end; ...]}
configList={ ...
    

    'Cath_BXG'   {'IN20'    0  230}; ...
    'BXG_BX01'   {'IN20'  231  660}; ...
    'BXG_FCG1'   {'IN20'  230  231; ...
                  'IN20'  799  899}; ...
    'BX01_BX02'  {'IN20'  660  751}; ...
    'BX01_SAB'   {'IN20'  899  999}; ...
    'BX02_QM15'  {'IN20'  751  799; ...
                  'LI21'    0   30; ...
                  'LI21'   99  335}; ...
    'QM15_BC2'   {'LI21'   30   99; ...
                  'LI21'  335  Inf; ...
                  'LI22'    0  Inf; ...
                  'LI23'    0  Inf; ...
                  'LI24'    0  700; ...
                  'LI24'  702  703}; ...
    'BC2'        {'LI24'  700  701; ...
                  'LI24'  703  899; ...
                  'LI24'  900  Inf}; ...
    'BC2_L3END'  {'LI24'  899  900; ...
                  'LI25'    0  Inf; ...
                  'LI26'    0  Inf; ...
                  'LI27'    0  Inf; ...
                  'LI28'    0  Inf; ...
                  'LI29'    0  Inf; ...
                  'LI30'    0  Inf}; ...
    'L3END_50B1' {'BSY0'    0   40; ...   % Should be deleted after VV??:BSY0 renamed?
                  'CLTH'    0  Inf}; ...  % Per 27JAN17 optics
    '50B1_BSY'   {'BSY0'   55  Inf; ...   % Should be deleted after VV??:BSY0 renamed?
                  'BSYH'    0  Inf}; ...  % Per 27JAN17 optics
    '50B1_DMP'   {'BSY0'   55  Inf; ...   % Should be deleted after VV??:BSY0 renamed?
                  'BSYH'    0  Inf; ...   % Per 27JAN17 optics
                  'LTU0'    0  Inf; ...
                  'LTU1'    0  Inf; ...
                  'UND1'    0  Inf; ...
                  'DMP1'    0  699}; ...
    '50B1_UND'   {'BSY0'   55  Inf; ...   % Should be deleted after VV??:BSY0 renamed?
                  'BSYH'    0  Inf;  ...  % Per 27JAN17 optics   
                  'LTU0'    0  Inf; ...
                  'LTU1'    0  Inf}; ...
    'UND_DMP'    {'UND1'    0  Inf; ...
                  'DMP1'    0  699}; ...
    '50B1_SL2'   {'BSY0'   40   55; ...
                  'CA01'    0  Inf; ...
                  'CA11'    0  Inf}; ...
    '50B1_ESA'   {'LI30' 1000  Inf; ...
                  'BSY0'   59   63; ...
                  'FB31'    0  Inf; ...
                  'CA11'  117  118; ...
                  'AB01'    0  Inf}; ...
    'BYD_SDMP'   {'DMP1'  699  Inf}; ...
% LCLS SC   
    
    'GUNB'       {'GUNB'   0   928}; ...
    'L0B'        {'L0B'   109  185}; ...
    'HTR'        {'HTR'   102  981}; ...
       'COL0'    {'COL0' 134 941}; ...
    'L1B'    {'L1B' 109 386}; ...
    'BC1B'    {'BC1B' 99 851}; ...
    'COL1'    {'COL1' 119 969}; ...
    'L2B'    {'L2B' 409 1586}; ...
    'BC2B'    {'BC2B' 125 951}; ...
    'EMIT2'    {'EMIT2' 149 913}; ...
    'L3B'    {'L3B' 1609 3586}; ...
    'EXT'    {'EXT' 350 763}; ...
    'DOG'    {'DOG' 104 912}; ...
    'BYP'    {  'BPN12' 849 851; ...
                'BPN13' 399 410; ...
                'BPN14' 399 851; ...
                'BPN15' 399 410; ...
                'BPN16' 399 851; ...
                'BPN17' 399 410; ...
                'BPN18' 399 410; ...
                'BPN19' 399 410; ...
                'BPN20' 399 410; ...
                'BPN21' 399 425; ...
                'BPN22' 399 425; ...  
                'BPN23' 399 410; ...
                'BPN24' 399 410; ...
                'BPN25' 399 425; ...
                'BPN26' 399 425; ...
                'BPN27' 399 410; ...
                'BPN28' 199 410}; ...
    'SPD_1'      {'SPD' 134 344}; ...
    'SPS'        {'SPS' 384 951}; ...
    'SLTS'       {'SLTS' 149 498}; ...


% LCLS 2020 Copper
    'GUN'        {'IN20'  109  223}; ...
    'L0'         {'IN20'  233  413}; ...
    'DL1_1'      {'IN20'  423  652}; ...
    'DL1_2'      {'IN20'  709  792}; ...
    'L1'         {'LI21'    0  176}; ...
    'BC1'        {'LI21'  179  336}; ...
    'L2'         {'LI21'   30  902; ...
                  'LI22'   09  902; ...
                  'LI23'   09  902; ...
                  'LI24'   09  704}; ...
    'BC2'        {'LI24'  699  902}; ...
    'L3'         {'LI24'  798  901; ...
                  'LI25'   09  921; ...
                  'LI26'   09  902; ...
                  'LI27'   09  902; ...
                  'LI28'   09  917; ...
                  'LI29'   09  957; ...
                  'LI30'   09  901}; ...
    'CLTH_0'     {'CLTH'  102  141}; ...
    'CLTH_1'     {'CLTH'  138  171}; ...
    'CLTS'       {'CLTH'  213  216; ...
                  'CLTS'  1    900}; ...
    'BSYS'       {'BSYS'  780  907}; ...
    'LTUS'       {'LTUS'  108  987}; ...
    'UNDS'       {'UNDS' 1678 5191}; ...
    'DMPS_1'     {'DMPS'  173  392}; ...
    'DMPS_2'     {'DMPS'  392  700}; ...
    'CLTH_2'     {'CLTH'  213  216}; ...
    'BSYH_1'     {'BSYH'  443  472}; ...
    'BSYH_2'     {'BSYH'  477  911}; ...
    'LTUH'       {'LTUH'  103  991}; ...
    'UNDH'       {'UNDH' 1304 5191}; ...
    'DMPH_1'     {'DMPH'  173  392}; ...
    'DMPH_2'     {'DMPH'  392  700}; ...

    'BSYA_1'     {'BSYH'  478  503; ...
                  'BSYA'  332  333}; ...
    'GUNB'       {'GUNB'   99  927}; ...
    'L0B'        {'L0B'   109  185}; ...
    'HTR'        {'HTR'   102  980}; ...
    'DIAG0'      {'COL0'  134  135; ...
                  'DIAG0' 159  530}; 

%
% BBA regions
%
    'BSY_End'     {'BSY0'   84   87; ...  % Should be deleted after VV??:BSY0 renamed?
                   'BSYH' 600  800}; ...  % New Q5 Q6, XCBSYQ5, YCBSYQ6 system loc 
    'UND_LaunchO' {'LTU1' 739  749; ...
                  'LTU1'  751  759; ...
                  'LTU1'  856  857; ...
                  'LTU1'  877  878; ...
                  'LTU1'  909  Inf}; ...
    'UND_Launch' {'LTU1'  729  738; ...
                  'LTU1'  817  818; ...
                  'LTU1'  877  878; ...
                  'LTU1'  746  747; ...
                  'LTU1'  836  837; ...
                  'LTU1'  856  857; ...
                  'LTU1'  909  Inf}; ...
    'UND_Launch2' {'LTU1' 729  738; ...
                  'LTU1'  817  818; ...
                  'LTU1'  877  878; ...
                  'LTU1'  746  747; ...
                  'LTU1'  836  837; ...
                  'LTU1'  856  857; ...
                  'UND1'  489  490; ...
                  'UND1'  589  590; ...
                  'UND1'  689  690; ...
                  'UND1'  789  790; ...
                  'UND1'  889  890; ...
                  'UND1'  989  990; ...
                  'UND1' 1089 1090}; ...
    'LI24_End'   {'LI24'  700  701; ...
                  'LI24'  899  Inf}; ...
    'UND'        {'LTU1'  900  Inf; ...
                  'UND1'    0 3390; ...
                  'DMP1'  298  299}; ...
%                  'DMP1'    0  199}; ...
    'UNDOld'     {'LTU1'  900  Inf; ...
                  'UND1'    0  Inf; ...
                  'DMP1'    0  199; ...
                  'DMP1'  300  301}; ...
%
% FACET regions
%
 
    'INJ'        {'IN10' 110   372}; ...
    'DL10'       {'IN10'  20   792}; ... %                  'LI10'  50   442}; ...
    'L1F'        {'LI11' 131   302}; ...
    'BC11_1'     {'LI11' 311   353}; ...
    'BC11_2'     {'LI11' 357   402}; ...
    'L2F'        {'LI11' 0     902; ...
                  'LI12' 0     902; ...
                  'LI13' 0     902; ...
                  'LI14' 0     902}; ...
    'BC14_1'     {'LI14' 700   716}; ...
    'BC14E'      {'LI14' 737   867}; ...
    'BC14_2'     {'LI14' 890   902}; ...
    'L3F_1'      {'LI14' 0     901; ...
                  'LI15' 0     945; ...
                  'LI16' 0     945; ...
                  'LI17' 0     945; ...
                  'LI18' 0     945; ...
                  'LI19' 0     945}; ...
    'L3F_2'      {'LI19' 500   901; ...
                  'LI20' 500  1989}; ...
    'BC20'       {'LI20'  44  3001}; ...
    'FF20'       {'LI20' 3010 3152}; ...
    'EXPT20'     {'LI20'  101   103}; ...
    'SPECT20'    {'LI20' 3264 3341}; ...
    'FF20'       {'LI20' 3010 3152}; ...
};  
    
     
% LEM exclude list
exclude=model_nameConvert({ ...
    'XCAPM2' 'YCAPM2' ...
    'CQ01' 'SQ01' 'BXG_TRIM' ...
    'BX01' 'BX02' 'BX01_TRIM' ...
    'BCX351' 'BCX352' 'BCX353' 'BCX354' ...
    'BCX361' 'BCX362' 'BCX363' 'BCX364' ...
    'BCX31B1' 'BCX31B2' 'BCX31B3' 'BCX31B4' ...
    'BCX32B1' 'BCX32B2' 'BCX32B3' 'BCX32B4' ...
    'BCX321_TRIM'  'BCX323_TRIM'  'BCX324_TRIM' ... 
    'BCX351_TRIM'  'BCX353_TRIM'  'BCX354_TRIM' ... 
    'BCX361_TRIM'  'BCX363_TRIM'  'BCX364_TRIM' ...   
    'BCX31B1_TRIM' 'BCX31B3_TRIM' 'BCX31B4_TRIM' ...
    'BCX32B1_TRIM' 'BCX32B2_TRIM' 'BCX32B3_TRIM' 'BCX32B4_TRIM' ...
    'BCXXL1_TRIM'  'BCXXL2_TRIM'  'BCXXL3_TRIM'  'BCXXL4_TRIM' ...
    'BLRCUS_TRIM' 'BRCUS1_TRIM' ...
    'BCXXL1' 'BCXXL2'  'BCXXL3' 'BCXXL4'
    });   

% Find remaining region tags and split into micro and unit part.
id=ismember(configList(:,1),region);
[microList,unitList,unit2List]=model_nameSplit(setdiff(region(:),configList(:,1)));
isUnit=~strcmp(unitList,'');isUnit2=~strcmp(unit2List,'');

% Set default unit range to 0 & inf.
unit=zeros(numel(unitList),1);unit2=inf(numel(unitList),1);
unit(isUnit)=str2num(char(unitList(isUnit)));
unit(isUnit & ~isUnit2)=unit(isUnit & ~isUnit2)-1; % No end unit do start-1
unit2List(isUnit & ~isUnit2)=unitList(isUnit & ~isUnit2);
unit2(isUnit)=str2num(char(unit2List(isUnit)));
microList(:,2:3)=reshape(num2cell([unit unit2]),[],2);
microList=[microList;vertcat(configList{id,2})];

% Remove UND1 micro from list if LEM option.
%if opts.LEM, microList(strcmp(microList(:,1),'UND1'),:)=[];end
%if opts.LEM, microList(strcmp(microList(:,1),'UND1'),2)={3379};end
if opts.LEM
    microList(strcmp(microList(:,1),'UNDH'),2)={4679}; %Include last Quad in UND line
    %microList(strcmp(microList(:,1),'UNDS'),2)={4779};
end

% Get devices matching prim and micro.
[nameT,id,isSLC]=model_nameConvert(prim(:),[{'EPICS'} opts.type],unique(microList(:,1)));
name=reshape(nameT(:,1),[],1);
nameT=reshape(nameT(:,2:end),size(nameT,1),numel(opts.type));

% Get unit numbers.
[p,m,u]=model_nameSplit(name);
u(cellfun('isempty',u))={'0'};
u=char(u);u(any(isletter(u),2),:)='0';
u=reshape(str2num(char(u)),[],1);
use=false(size(name));

% Select devices with unit numbers within range per micro.
for j=1:size(microList,1)
    [micro,u1,u2]=deal(microList{j,:});
    use=use | any(strcmp([p m],micro),2) & u > u1 & u <= u2;
end

% Deal with special cases.
if ismember('QM15_BC2',region), use(strcmp(name,model_nameConvert('XC24702')))=true;end
%if ismember('BC2_L3END',region), use(strcmp(name,model_nameConvert('Q24701B')))=true;end
if ismember('BC2',region), use(strcmp(name,model_nameConvert('Q24701B')))=true;end
if ismember('50B1_DMP',region), use(ismember(name,model_nameConvert({'B4CXRAY' 'YAGXRAY'})))=false;end
if ismember('UND_DMP',region), use(ismember(name,model_nameConvert({'B4CXRAY' 'YAGXRAY'})))=false;end
if ismember('BYD_SDMP',region), use(ismember(name,model_nameConvert({'B4CXRAY' 'YAGXRAY'})))=true;end

if opts.LEM
    for ii = 1:length(name)
        if strcmp(name{ii}(6:9),'UNDS')
            use(ii) = false;
        end
    end
    use(ismember(name, model_nameConvert({ 'QSXH16' 'QSXH19' 'QSXH21' 'QSXH24'})))=true;
end

% Remove non-LEM devices.
if opts.LEM, use(ismember(name,exclude))=false;end


% Make final list.
name=nameT(use,:);
id=id(use,:);
isSLC=isSLC(use);

